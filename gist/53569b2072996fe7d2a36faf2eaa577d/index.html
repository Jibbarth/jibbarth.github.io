<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta http-equiv="X-UA-Compatible" content="ie=edge">
        <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
        <link rel="manifest" href="/site.webmanifest">
            <title>[Sylius] Restrict Payment Methods depending on customer group // Jib√© Barth</title>
                <meta name="author" content="Jib√© Barth">
        <meta name="description" content="It could be common to display some payment methods only to customers that belong to a group.
For example, you can add an offline payment method for you B2B customers, and invoice them at the end...
">
        <meta name="image" content="https://images.unsplash.com/photo-1580894723150-0ff6e9b907ea?crop=entropy&amp;cs=srgb&amp;fm=jpg&amp;ixid=M3w2MzI5ODF8MHwxfHJhbmRvbXx8fHx8fHx8fDE3MzA5ODIxMzB8&amp;ixlib=rb-4.0.3&amp;q=85&amp;auto=format&amp;w=600&amp;h=400&amp;fit=crop&amp;crop=edges,entropy">
                <meta itemprop="name" content="[Sylius] Restrict Payment Methods depending on customer group // Jib√© Barth">
        <meta itemprop="description" content="It could be common to display some payment methods only to customers that belong to a group.
For example, you can add an offline payment method for you B2B customers, and invoice them at the end...
">
        <meta itemprop="image" content="https://images.unsplash.com/photo-1580894723150-0ff6e9b907ea?crop=entropy&amp;cs=srgb&amp;fm=jpg&amp;ixid=M3w2MzI5ODF8MHwxfHJhbmRvbXx8fHx8fHx8fDE3MzA5ODIxMzB8&amp;ixlib=rb-4.0.3&amp;q=85&amp;auto=format&amp;w=600&amp;h=400&amp;fit=crop&amp;crop=edges,entropy">
                <meta name="twitter:card" content="summary_large_image">
        <meta name="twitter:site" content="@Jibbarth">
        <meta name="twitter:creator" content="@Jibbarth">
        <meta name="twitter:image" content="https://images.unsplash.com/photo-1580894723150-0ff6e9b907ea?crop=entropy&amp;cs=srgb&amp;fm=jpg&amp;ixid=M3w2MzI5ODF8MHwxfHJhbmRvbXx8fHx8fHx8fDE3MzA5ODIxMzB8&amp;ixlib=rb-4.0.3&amp;q=85&amp;auto=format&amp;w=600&amp;h=400&amp;fit=crop&amp;crop=edges,entropy">
                <meta name="og:title" content="[Sylius] Restrict Payment Methods depending on customer group // Jib√© Barth">
        <meta name="og:description" content="It could be common to display some payment methods only to customers that belong to a group.
For example, you can add an offline payment method for you B2B customers, and invoice them at the end...
">
        <meta name="og:image" content="https://images.unsplash.com/photo-1580894723150-0ff6e9b907ea?crop=entropy&amp;cs=srgb&amp;fm=jpg&amp;ixid=M3w2MzI5ODF8MHwxfHJhbmRvbXx8fHx8fHx8fDE3MzA5ODIxMzB8&amp;ixlib=rb-4.0.3&amp;q=85&amp;auto=format&amp;w=600&amp;h=400&amp;fit=crop&amp;crop=edges,entropy">
        <meta name="og:url" content="https://xn--jibbarth-d1a.fr/gist/53569b2072996fe7d2a36faf2eaa577d">
        <meta name="og:site_name" content="Jib√© Barth">
        <meta name="og:type" content="article">
        <link rel="alternate" type="application/rss+xml" href="/rss.xml" title="Rss feed for https://jib√©barth.fr">
                                                
<link rel="stylesheet" href="/assets/css/app-ab0016e123ad097a3b7eeb892f5b9dbd.css">
<script type="importmap" data-turbo-track="reload">
{
    "imports": {
        "app": "/assets/app-618d01ee3c02aebd41603136cbef9c24.js",
        "/assets/css/app.css": "data:application/javascript,",
        "/assets/bootstrap.js": "/assets/bootstrap-97656ab68e522ab9732b853e32a2116f.js",
        "@symfony/stimulus-bundle": "/assets/@symfony/stimulus-bundle/loader-870999a02e9fc147c034d522826ea70d.js",
        "@hotwired/stimulus": "/assets/vendor/@hotwired/stimulus/stimulus.index-b5b1d00e42695b8959b4a1e94e3bc92a.js",
        "/assets/@symfony/stimulus-bundle/controllers.js": "/assets/@symfony/stimulus-bundle/controllers-0673059c18ae100eb0b8b6fd6dd33610.js",
        "/assets/@symfony/ux-lazy-image/controller.js": "/assets/@symfony/ux-lazy-image/controller-888a830fb2881572020d3f9e795c864f.js",
        "/assets/@symfony/ux-turbo/turbo_controller.js": "/assets/@symfony/ux-turbo/turbo_controller-ce5e32dafdec0b7752f02e3e2cb25751.js",
        "@hotwired/turbo": "/assets/vendor/@hotwired/turbo/turbo.index-0ec782120ea86cbcea9f5e0c8e1660fe.js",
        "/assets/controllers/share_controller.js": "/assets/controllers/share_controller-ea6525d722c6d99d807a7d033a521620.js",
        "/assets/controllers/gist_file_controller.js": "/assets/controllers/gist_file_controller-c51c5894678014b4827a4b2a61e9d008.js",
        "/assets/controllers/code_highlight_controller.js": "/assets/controllers/code_highlight_controller-9767d6b9459643c0c328addd0d0e2aa2.js",
        "/assets/controllers/tweet_embed_controller.js": "/assets/controllers/tweet_embed_controller-45487951ccb866008ddfd6f7ce7bed08.js",
        "prismjs": "/assets/vendor/prismjs/prismjs.index-4c2b193d1354b5b7a17b3cdc9e56d1b8.js",
        "prismjs/themes/prism.min.css": "data:application/javascript,document.head.appendChild%28Object.assign%28document.createElement%28%22link%22%29%2C%7Brel%3A%22stylesheet%22%2Chref%3A%22%2Fassets%2Fvendor%2Fprismjs%2Fthemes%2Fprism.min-1698e178d1bb208a059f63cb8dcc0517.css%22%7D%29%29",
        "prism-themes": "/assets/vendor/prism-themes/prism-themes.index-d02ff3bd582665186ee4c6486f20c980.js",
        "jsonp": "/assets/vendor/jsonp/jsonp.index-a7a3c99e313e8a943069181232465b36.js",
        "debug": "/assets/vendor/debug/debug.index-54eb343bb6d4b5b6daad2646a0c85f7f.js",
        "ms": "/assets/vendor/ms/ms.index-24e44b76766726752b7ec88b50311e6c.js",
        "prism-themes/themes/prism-vsc-dark-plus.css": "data:application/javascript,document.head.appendChild%28Object.assign%28document.createElement%28%22link%22%29%2C%7Brel%3A%22stylesheet%22%2Chref%3A%22%2Fassets%2Fvendor%2Fprism-themes%2Fthemes%2Fprism-vsc-dark-plus-4e4743d943ac682cd8a1363ee3bf368c.css%22%7D%29%29",
        "prismjs/components/prism-core": "/assets/vendor/prismjs/components/prism-core-8e6b9c91521422cb34ac4cd0b822ba67.js",
        "prismjs/plugins/autoloader/prism-autoloader": "/assets/vendor/prismjs/plugins/autoloader/prism-autoloader-dcb1837f56c5fa84e648668a6b798bf5.js",
        "prismjs/components/prism-ini.min.js": "/assets/vendor/prismjs/components/prism-ini.min-df7734dbe502b37bf458f7ec0bb16d5a.js",
        "prismjs/components/prism-bash.min.js": "/assets/vendor/prismjs/components/prism-bash.min-cee217d6d55063b19abd17cce3a8ac0d.js",
        "prismjs/components/prism-css.min.js": "/assets/vendor/prismjs/components/prism-css.min-61b09547d9e955018597ea926ad170f2.js",
        "prismjs/components/prism-diff.min.js": "/assets/vendor/prismjs/components/prism-diff.min-0b61f375e1f5fa148833b4863200048a.js",
        "prismjs/components/prism-javascript.min.js": "/assets/vendor/prismjs/components/prism-javascript.min-1dd12ea45bd8053ee15ec70c286e783f.js",
        "prismjs/components/prism-json.min.js": "/assets/vendor/prismjs/components/prism-json.min-547eb54b73faba145fb7981f07ceb520.js",
        "prismjs/components/prism-markup.min.js": "/assets/vendor/prismjs/components/prism-markup.min-03264ab55e7228d565a46b034da13e16.js",
        "prismjs/components/prism-php.min.js": "/assets/vendor/prismjs/components/prism-php.min-40d11e3bad4f2ce85f71cde26868e952.js",
        "prismjs/components/prism-twig.min.js": "/assets/vendor/prismjs/components/prism-twig.min-df5fbaff3a747192f0c42a0834058ee3.js",
        "prismjs/components/prism-yaml.min.js": "/assets/vendor/prismjs/components/prism-yaml.min-f93d0999bdacb42e9e2c9ed05185c079.js",
        "prismjs/components/prism-clike.min.js": "/assets/vendor/prismjs/components/prism-clike.min-3f111a1714fac676929cfe6b3eb88835.js",
        "prismjs/components/prism-markup-templating.min.js": "/assets/vendor/prismjs/components/prism-markup-templating.min-1919ad14f0e4ab43685b3923a0e1cd53.js",
        "prism-themes/themes/prism-vsc-dark-plus.min.css": "data:application/javascript,document.head.appendChild%28Object.assign%28document.createElement%28%22link%22%29%2C%7Brel%3A%22stylesheet%22%2Chref%3A%22%2Fassets%2Fvendor%2Fprism-themes%2Fthemes%2Fprism-vsc-dark-plus.min-e5aac3e8a94361b21c1c654dfea1b59b.css%22%7D%29%29",
        "prismjs/components/prism-core.min.js": "/assets/vendor/prismjs/components/prism-core.min-2cd152a748317b5300c86545fea5fb97.js"
    }
}
</script>
<!-- ES Module Shims: Import maps polyfill for modules browsers without import maps support -->
<script async src="https://ga.jspm.io/npm:es-module-shims@1.10.0/dist/es-module-shims.js" crossorigin="anonymous" integrity="sha384-ie1x72Xck445i0j4SlNJ5W5iGeL3Dpa0zD48MZopgWsjNB/lt60SuG1iduZGNnJn" data-turbo-track="reload"></script>
<link rel="modulepreload" href="/assets/app-618d01ee3c02aebd41603136cbef9c24.js">
<link rel="modulepreload" href="/assets/bootstrap-97656ab68e522ab9732b853e32a2116f.js">
<link rel="modulepreload" href="/assets/@symfony/stimulus-bundle/loader-870999a02e9fc147c034d522826ea70d.js">
<link rel="modulepreload" href="/assets/vendor/@hotwired/stimulus/stimulus.index-b5b1d00e42695b8959b4a1e94e3bc92a.js">
<link rel="modulepreload" href="/assets/@symfony/stimulus-bundle/controllers-0673059c18ae100eb0b8b6fd6dd33610.js">
<link rel="modulepreload" href="/assets/@symfony/ux-lazy-image/controller-888a830fb2881572020d3f9e795c864f.js">
<link rel="modulepreload" href="/assets/@symfony/ux-turbo/turbo_controller-ce5e32dafdec0b7752f02e3e2cb25751.js">
<link rel="modulepreload" href="/assets/vendor/@hotwired/turbo/turbo.index-0ec782120ea86cbcea9f5e0c8e1660fe.js">
<script type="module" data-turbo-track="reload">import 'app';</script>
                        <script async src="https://analytics.xn--jibbarth-d1a.fr/script.js" data-website-id="caa51ea4-63ea-44b1-bf0d-8403b639829b" data-auto-track="false"></script>
            </head>
    <body class="flex flex-col min-h-screen bg-gray-300 font-sans">
        <header>
                        <div class="bg-gray-100 mb-6 pb-6 w-full h-auto flex flex-col items-center shadow-sm">
                <div class="h-64 xl:h-full w-full">
                            <img
        class="h-full w-full object-cover"
        src="data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD//gA7Q1JFQVRPUjogZ2QtanBlZyB2MS4wICh1c2luZyBJSkcgSlBFRyB2ODApLCBxdWFsaXR5ID0gODAK/9sAQwAGBAUGBQQGBgUGBwcGCAoQCgoJCQoUDg8MEBcUGBgXFBYWGh0lHxobIxwWFiAsICMmJykqKRkfLTAtKDAlKCko/9sAQwEHBwcKCAoTCgoTKBoWGigoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgo/8AAEQgBLAZAAwEiAAIRAQMRAf/EAB8AAAEFAQEBAQEBAAAAAAAAAAABAgMEBQYHCAkKC//EALUQAAIBAwMCBAMFBQQEAAABfQECAwAEEQUSITFBBhNRYQcicRQygZGhCCNCscEVUtHwJDNicoIJChYXGBkaJSYnKCkqNDU2Nzg5OkNERUZHSElKU1RVVldYWVpjZGVmZ2hpanN0dXZ3eHl6g4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2drh4uPk5ebn6Onq8fLz9PX29/j5+v/EAB8BAAMBAQEBAQEBAQEAAAAAAAABAgMEBQYHCAkKC//EALURAAIBAgQEAwQHBQQEAAECdwABAgMRBAUhMQYSQVEHYXETIjKBCBRCkaGxwQkjM1LwFWJy0QoWJDThJfEXGBkaJicoKSo1Njc4OTpDREVGR0hJSlNUVVZXWFlaY2RlZmdoaWpzdHV2d3h5eoKDhIWGh4iJipKTlJWWl5iZmqKjpKWmp6ipqrKztLW2t7i5usLDxMXGx8jJytLT1NXW19jZ2uLj5OXm5+jp6vLz9PX29/j5+v/aAAwDAQACEQMRAD8A91oooqiAooooAKKKKACiiigAooooAKKKKACiiigAoopaAEopcUYoASlFLRQAUUUUAFFFFABRRRQAUUUUAFFGKMUAFFGKXFACUUtFAXExS4oooAKKKKQBRRRQAUUUUxhRRRQAUUUUAFFFFFgCiiiiwBRRRQAUUUUAFFFFIAooooAKKKKACiiigLhRRRQMKTFLRQAmKKWimKwlFLRigBKKMUYoAKKKKACiiigYUUUUgCkNLRQA2iloxTEJRRRQMKKKKACkNLRQAlFLikoEFFFFAwooooASilpKBBRRRQAUUUUDENJTqKBDaKWjFMBKKXFGKAEopcUYpAJRS0lMAooooAKKKKACkpaKAEopcUlABRRRQAUUUYoAKKXFFAgFFFFABRRRQAUUUUAFFFFABS0UUALRRRQAUUUUwCiiigQUUUUhBRRRTABS0UUAFFFFIApaBRQAUUUUAFOpBS0wCiiigApaBRQAUUUUxBRRS4pAAooooAKKKKACiilxQACloooAKKKKAAUtFFAgooopDCloooAKKKKBBRRS4oABS0UUAFFFFABRRRigAopcUUAFFFFABRRRQAUUUUAFFFFABRRRQBUop1FI0G0U6igBtFOooASilooATFGKWigBMUYpaKAExRS0UAFFGKMUAFFGKXFACUUuKKAEopaKAExRilooAMUUUUAFFGKMUAFFLijFACUUuKMUAJRS4oxQAlFLRQAlFLRQAlFLRQMSjFLRQAmKMUtFACYpcUUUAGKMUUUAGKMUUUAGKMUUUAJijFLRQAmKKWigBKKWigBKKWigBKKWigBKKWigBKKWigBKKWikAlFLijFACUUuKMUDEooxRQAYpMUtFMQmKKWigYlFLRigBKKMUYoAKTFLRQAmKSnUUANopaMUAJRS4pKADFJilooEJRS0YoASijFFABSYpaKAEopaKAEopcUYpgJRRijFABRRijFABRRiigApKWigBMUlOooAbRS4oxQAlFFFABRRRQAUUUUCCiiigLBRRRQAUUUUAFFFLigBKKXFFMAoxS0UAFFFFFgCiiigQUUUYoAKKMUYoAKKXFFACUtFFAgoopcUAJS4oooAKKKXFACUuKWigAoooxQAUtFFABRRS4oEJS4oooAKKKWgBKKXFFABRilooAKKKMUAFFLiigBMUtFFABRS4ooAMUUUtIBKKXFFAgoxS0UAFFGKMUAFFLRQAmKXFFFABRRilxQAlFLiigBKKWigBMUuKKKADFGKKWgBMUYpaMUAJiilxRigCrijFLijFI0ExRilxRigBMUYpcUYoATFGKXFGKAEopcUYoASilooASilooASilpaAG4pcUuKMUAJijFLijFACYopcUYoASilpaAG0U6igBtLS0UAJRilooATFGKXFGKAExRilxRigBMUYpcUYoATFGKXFLigY3FGKdijFADcUtLijFACUUuKMUAJRS4ooASilooASilopAJRS0UwEopcUYoASkp2KMUgG4oxTsUYoAbijFOxRigBuKMU7FGKAG4oxTsUYoAbijFOxSYoATFGKXFGKAExRilxRigBMUUuKKAEpKdRQMbRTqSgBKMUuKMUwExSYp2KKAG0UtFACUUtGKAExSYp2KTFACYopaKAEopaMUANoxS4ooEJikp1FADaKWjFAxMUYpcUYoEJijFLiimA3FGKWigBKKWigBKKWjFACUUuKSgAxSYpaKAEopaKAEooxRigApKWigBMUYpaKAExRilopgJijFLRQITFGKWigBMUtFFABRRRQAUUYoxQAUUuKKAExRilooAKKKKYBRRRQIKKMUuKAEopcUUAJS4opaBCUUuKMUgEpcUtFACUtGKMUAFGKWigAoopcUAJS4oooAKKXFLTEJijFLRQAUUYpcUAJRilopAJilxRS4oASilxRQAlLiilxQAlFLiloASjFLRigBKWlxRQAlGKWjFIAxRS4ooEJRilpaAExRilxRigBKKWloAbS4paKAExRilxRigBMUUuKXFACUUtFACUUtFACUUtFACUUtFAFXFGKdijFBoNxRinYoxSAbijFOxRigBuKMU7FGKAG4oxTsUUANpaWigBKKWigBKKXFGKAExRinYoxQA3FGKdijFACYoxS4oxQAmKKXFFACUUtFACUUtLQA2inUYoAbijFOxRigBMUYpcUYoATFGKXFGKBiYoxS4oxQAmKMUuKMUAJijFLS0ANxRTqKAG0U6igBtFOopANop1FADaKdRQA2inUUANxRinUUANxRinUUANxRinUUANxRinUUANxRinUlACYoxS4oxQAmKMUuKMUAJijFLijFADcUU7FFAxtFLRQAlGKWjFADcUYp2KMUANxRS4opgJRS0UANxRilxRigBMUlOooAbRTqTFACYoxS4ooAbRS0UAJRilxRigBuKMUuKKBCYopaKYxKKWjFAhKSlxRQAmKMUtFACUlOooAbRS0YpgJRiiigBMUUtFACUUuKMUAJRRRQAmKMUtFACYoxS0UAJijFLRimITFGKWigBMUuKKKACiiigAoopcUAJRS4ooEJS4oooAKKKWgBKKXFLQFxMUYpaKAExRS4pcUCEoxS0UAJilxRRQAUUUuKAEopaKADFFFLigBKWiloATFLRS4oASjFLRQIKKXFFACUuKKWgBMUUuKMUAJS4paKAExRilxS4oASilopAJilpcUYoASjFLS4oATFFLiigBKXFLRikAmKKXFLQISiloxQAmKMU7FGKAEopaWgBtGKdijFACYoxS4oxQAmKMUtLQA2inUUAJRS4oxQAmKMUuKMUAJijFLijFAFWinUUGg2inUUANop1FADaKdRQA2lpaKAEopaKQCUYpaMUAJijFLijFACYoxS4oxQAmKMUuKXFADcUYp2KMUANpaWigBKKWigBKKWigBMUYpcUuKAG4oxTsUYoAbijFOxRigYmKMUuKMUAJijFLRQAlFLRQAlFLRQAlFOopANop1FADaKdRQA2inUUANop1FADaKdijFADaKdijFADaKdijFADaKdiigBtFOooAbRS0UAJRS0UAJijFLijFAxuKMU7FGKAG4opcUUAJRS0UANoxTqTFACYoxS4ooASkp1FADaMUuKMUwExSYp1JQAlFLRigBMUmKXFFACUUtFACUmKXFFACYoxS0UANop1JimISjFLSUAGKSlooASilxSYoAKMUUUwExRS0UAJRS0lABSYpaKAExSU6koASilxRimISilpaAG0U6igBtFLikoAKKKKACiiigAoxRRQAYooooEFFFFABRS0YpgJS4paKAEpaKKBBRRS0AJiloooAKKKXFACUuKKKADFFFFABRS0YpAJS4paKAEpaKXFACUtFFABRS0UAFFLRQIMUYpaMUAFGKWigBMUtLiigBKMU6jFACYoxS4oxQAlFOooATFGKXFLigBKMUtGKQCYpaXFFACUuKWjFACYopcUtIQlGKXFGKAExRTsUUAJRilpcUANxRinYoxQAmKKWloAbRTsUYoAbilxS4oxQAmKMUuKMUAJijFLijFACYoxS4oxQBVopcUYoNBKKXFGKAEopcUYoASilxRigBKKWigBKKWigBKKWigBKMUtFIBMUuKKKADFGKWjFACYoxS4oxQAlFLijFACUUtLQA2lpaKAEoxS0UDExRilooATFGKXFGKAExRilxRigBKWlxRigBKKWikAlFLRQAlFLRQAlFLRQAlFLRQAlFLRQAlFLRQAlGKWigBMUYpaKAExRS0UAJRS0UAJRS0UAJRS0UDEpKdikxQAmKMUuKKAExRilooAbRTqSgBKKXFGKAExSYpaKAEopaMUAJRiiimAmKKWigBKKMUUAJikp1FADaKWkoAMUlLRQAlFKaSmAUmKWigQlFBooGFJS0UCG0UtJQMKKKKYgpKWg0AJRRRTAKKKKAExRS0GgQlFFFAwooooEFFFFMAooooAKSlooAbRS4ooASinUUAJRilooATFGKWigBKWiigAoooosIKKKKYgoooFAC0UUUgCiigUwFooopAFLSU6gBMUUtFABRS0UAJilxRS4oEJRS0UAGKKWjFACUuKKWgAoopaACiilFABiiiloASlxS0UgCjFLRQAmKWjFLQAlGKWloATFGKXFGKAEpaWigBMUtGKWkAlGKWjFABRS4ooEJilxS0YpAJRS0tACYoxS4oxQAmKKdiigBKKWjFACYoxTsUYoATFGKXFFACYopaKAEopaWgBtFOooApUUuKMUGglFLS0ANop1FADaWlooASjFLRQAmKMUtFACYoxS0UAJS0UUAFFFFAWCiijFABRS4opAJRS0UAJijFLRQMMUUUUAFFFFABRRRigAopcUYoASiloouAlGKWigBMUuKKKQBijFFFABijFFFABijFFFABijFFFABiiiigAooooAKKKKACiiigAooooAKMUUUDDFGKKKAEopaKAEopcUlAgooooGFJilooASilpKACiiigBKSnUhoASiiigApDS0GmAlFFFABSGlpKACiiigAptKaSgAooooAKSg0UwCiiigANJRRQAUUUmaYgNJRRTAKKKM0AFJRRQAUUUUAFFJmigBc0lFFMQUUUlAC0UmaM0ALRSUlFgHUlJRRYBc0ZpKKAFzRmkooAWlptFADqKbRTAdRTaKBDqKbRQA6im0tFgFopM0ZoELRRRQAtFJRmgBaKKKAFopKWgAp1NpRQAtFFFAC0UgpaBAKWkpaACiiigBRS0gpaQBQKKBTAWiiikAoooooAUUtIKWgApaQUtABSikFLQAUtJTqQBRRRQAUYpaKACiiloASlxRRQAUUtFIQYopaKACjFLRQAYoopcUgEoxS0UAGKKWjFACUtLRQAmKMUtFACYopcUYoAKKXFFACUUtFACUUtFAFKiiig0CiiigAooooAKKKKACiiigAooooGFFFFABRRRQAUtJRmgQtFFFIAooooGFFFFABRRRQAUUUUAFKKSigBaKM0UAFFFFABRRRQAUUUUgCiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooGFFGaM0AFFJmigBc0lFFAB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"
        data-controller="symfony--ux-lazy-image--lazy-image" data-symfony--ux-lazy-image--lazy-image-src-value="https://images.unsplash.com/photo-1581091877018-dac6a371d50f?crop=entropy&amp;cs=srgb&amp;fm=jpg&amp;ixid=M3w2MzI5ODF8MHwxfHJhbmRvbXx8fHx8fHx8fDE3MzA5ODIxMzR8&amp;ixlib=rb-4.0.3&amp;q=85&amp;auto=format&amp;w=1600&amp;h=300&amp;fit=crop&amp;crop=edges,entropy"
        alt="Banner image for this article, an unsplash image with coding theme">
                </div>
                <div class="-ml-56 sm:w-64">
                    <div class="shadow h-32 w-32 -my-16 border-white rounded-full overflow-hidden border-4">
                        <a href="/">
                                                        <img class="object-cover w-full h-full"
                                 alt="profile picture"
                                 src="data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD//gA7Q1JFQVRPUjogZ2QtanBlZyB2MS4wICh1c2luZyBJSkcgSlBFRyB2ODApLCBxdWFsaXR5ID0gODAK/9sAQwAGBAUGBQQGBgUGBwcGCAoQCgoJCQoUDg8MEBcUGBgXFBYWGh0lHxobIxwWFiAsICMmJykqKRkfLTAtKDAlKCko/9sAQwEHBwcKCAoTCgoTKBoWGigoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgo/8AAEQgAeAB4AwEiAAIRAQMRAf/EAB8AAAEFAQEBAQEBAAAAAAAAAAABAgMEBQYHCAkKC//EALUQAAIBAwMCBAMFBQQEAAABfQECAwAEEQUSITFBBhNRYQcicRQygZGhCCNCscEVUtHwJDNicoIJChYXGBkaJSYnKCkqNDU2Nzg5OkNERUZHSElKU1RVVldYWVpjZGVmZ2hpanN0dXZ3eHl6g4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2drh4uPk5ebn6Onq8fLz9PX29/j5+v/EAB8BAAMBAQEBAQEBAQEAAAAAAAABAgMEBQYHCAkKC//EALURAAIBAgQEAwQHBQQEAAECdwABAgMRBAUhMQYSQVEHYXETIjKBCBRCkaGxwQkjM1LwFWJy0QoWJDThJfEXGBkaJicoKSo1Njc4OTpDREVGR0hJSlNUVVZXWFlaY2RlZmdoaWpzdHV2d3h5eoKDhIWGh4iJipKTlJWWl5iZmqKjpKWmp6ipqrKztLW2t7i5usLDxMXGx8jJytLT1NXW19jZ2uLj5OXm5+jp6vLz9PX29/j5+v/aAAwDAQACEQMRAD8A9saoZKkJqGQ1yDRUn71n3Her81UJ6DWJnzVSkFXphVSQVlM66ZXp8fWgjmnIK46iOqJZiq9D2qjFV2I1itwkXoe1XI6oxGrcbV00zkmW0NSqarI1Sq1dsDkmTA0VHuorYyGlqidqYXpjNUWGiOU1TmqzIarSUWNoFKUVWdauyCq7rWckdlMqFaVRUpWkxXHUR1RHx1ZjNVlqVDWFgki9G1WUes9HqdJK6KZy1EaCvUgeqCyU8S12wOKZe8yiqYl96K2sYh5lIXqr5lJ5lTYpE7NUTGm76QtTsbwGMKhYVMajas5I66ZCwphFStUbVyzR1RG0oamE0wtXM0U0WVepFkqj5lHm1tTOWojREvvThN71m+d70vne9dtNHDUNLzveis3z6K3SOctebSiT3rP82niWlYaL4kpweqSyU8SUWOiBa3U0mot9Bes5I64Csahc0rPULvXNNHXER2qFnpHeq0j1zSRbJWkphlqs8lQtLWlM5qhe873pPP8Aes4zUwz+9d1M8+qafn+9FZXn+9FdKRzM1RL709ZazfNp6y1NhJmostSrLWUs3vUizUrHRBmoJaXzKzhN70vnVnI7IMvNJULyVWM1RNLXNM6oslkkqtJJTZJarSSVyyNGx0klV3lqOSSq0klXA56jJnm96iaaqsktQPLXoUjzqrLxn96KzDN70V0pHI2b3m+9OE3vWf5lHm1JKkaQm96eJ/esnz/ej7R70mdEJGyLj3pftHvWL9p96UXPvWUjsps2TP700ze9ZQuPel8/3rkqM64svtL71C8lVjL70xpK5WynIfI9VpHod6ryNV0znqSGySVWkkolaqkj16NI86tIkaWiqbSUV1o4nM6EyUxpKhLVC71AlInaaomuMd6qSy4qpJPjvSZtCRpfafelF171iNce9C3PvWFR2O+lI31ufepknz3rBjuPercU2e9efUmdkWbCy5p2+qEcmamVq5ua42yZmqGQ04moZDXRTOapIglaqUrVZlPWqUxr0aR5taRC7UVE55orsR57lqdCx4qCU0UVmalGZutUJnNFFDNIFR5DmmrIc0UVyVtj0aJahkNX4Hoorxqsnc747F+FqtoaKKmIpD81E9FFdlI5ahVm71Rmoor0qR5tYpydaKKK7EedLc//2Q=="
                                 data-controller="symfony--ux-lazy-image--lazy-image" data-symfony--ux-lazy-image--lazy-image-src-value="https://gravatar.com/avatar/f7a23636c530faa0ceca6199226902e7?s=200"
                                 width="120"
                                 height="120"
                            />
                        </a>
                    </div>
                </div>
                <div class="mt-16 sm:mt-4">
                    <h1 class="text-3xl text-center font-bold">
                        Jib√© Barth
                    </h1>
                    <p class="text-sm text-gray-600 text-center">
                        üá´üá∑ Web developer
                        <div class="text-center">
                            <a
        href="https://github.com/Jibbarth"
        title="Github"
        target="_blank"
        rel="nofollow,noopener"
        class="text-gray-600 hover:text-black"
    >
        <svg width="0.97em" height="1em" viewBox="0 0 496 512" id="78b59e68f5bc6b5d0e83965fc61f2065" fill="currentColor" class="icon-inline" aria-hidden="true"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6c-3.3.3-5.6-1.3-5.6-3.6c0-2 2.3-3.6 5.2-3.6c3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9c2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9c.3 2 2.9 3.3 5.9 2.6c2.9-.7 4.9-2.6 4.6-4.6c-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2c12.8 2.3 17.3-5.6 17.3-12.1c0-6.2-.3-40.4-.3-61.4c0 0-70 15-84.7-29.8c0 0-11.4-29.1-27.8-36.6c0 0-22.9-15.7 1.6-15.4c0 0 24.9 2 38.6 25.8c21.9 38.6 58.6 27.5 72.9 20.9c2.3-16 8.8-27.1 16-33.7c-55.9-6.2-112.3-14.3-112.3-110.5c0-27.5 7.6-41.3 23.6-58.9c-2.6-6.5-11.1-33.3 2.6-67.9c20.9-6.5 69 27 69 27c20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27c13.7 34.7 5.2 61.4 2.6 67.9c16 17.7 25.8 31.5 25.8 58.9c0 96.5-58.9 104.2-114.8 110.5c9.2 7.9 17 22.9 17 46.4c0 33.7-.3 75.4-.3 83.6c0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252C496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2c1.6 1.6 3.9 2.3 5.2 1c1.3-1 1-3.3-.7-5.2c-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9c1.6 1 3.6.7 4.3-.7c.7-1.3-.3-2.9-2.3-3.9c-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2c2.3 2.3 5.2 2.6 6.5 1c1.3-1.3.7-4.3-1.3-6.2c-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9c1.6 2.3 4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2c-1.4-2.3-4-3.3-5.6-2"></path></svg>
    </a>
    <a
        href="https://twitter.com/jibbarth"
        title="Twitter"
        target="_blank"
        rel="nofollow,noopener"
        class="text-gray-600 hover:text-black"
    >
        <svg width="1em" height="1em" viewBox="0 0 512 512" id="8219b698da8a87b88bdb58210f93907f" fill="currentColor" class="icon-inline" aria-hidden="true"><path fill="currentColor" d="M459.37 151.716c.325 4.548.325 9.097.325 13.645c0 138.72-105.583 298.558-298.558 298.558c-59.452 0-114.68-17.219-161.137-47.106c8.447.974 16.568 1.299 25.34 1.299c49.055 0 94.213-16.568 130.274-44.832c-46.132-.975-84.792-31.188-98.112-72.772c6.498.974 12.995 1.624 19.818 1.624c9.421 0 18.843-1.3 27.614-3.573c-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319c-28.264-18.843-46.781-51.005-46.781-87.391c0-19.492 5.197-37.36 14.294-52.954c51.655 63.675 129.3 105.258 216.365 109.807c-1.624-7.797-2.599-15.918-2.599-24.04c0-57.828 46.782-104.934 104.934-104.934c30.213 0 57.502 12.67 76.67 33.137c23.715-4.548 46.456-13.32 66.599-25.34c-7.798 24.366-24.366 44.833-46.132 57.827c21.117-2.273 41.584-8.122 60.426-16.243c-14.292 20.791-32.161 39.308-52.628 54.253"></path></svg>
    </a>
    <a
        href="https://linkedin.com/in/jib√©barth"
        title="Linkedin"
        target="_blank"
        rel="nofollow,noopener"
        class="text-gray-600 hover:text-black"
    >
        <svg width="0.88em" height="1em" viewBox="0 0 448 512" id="89398c599d244375d7250c859ddb011f" fill="currentColor" class="icon-inline" aria-hidden="true"><path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3M135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5c0 21.3-17.2 38.5-38.5 38.5m282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7c-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5c67.2 0 79.7 44.3 79.7 101.9z"></path></svg>
    </a>
    <a
        href="https://connect.symfony.com/profile/jibbarth"
        title="Symfony"
        target="_blank"
        rel="nofollow,noopener"
        class="text-gray-600 hover:text-black"
    >
        <svg width="1em" height="1em" viewBox="0 0 512 512" id="e56831514b62735089abaf9ae45ff23c" fill="currentColor" class="icon-inline" aria-hidden="true"><path fill="currentColor" d="M256 8C119 8 8 119 8 256s111 248 248 248s248-111 248-248S393 8 256 8m133.74 143.54c-11.47.41-19.4-6.45-19.77-16.87c-.27-9.18 6.68-13.44 6.53-18.85c-.23-6.55-10.16-6.82-12.87-6.67c-39.78 1.29-48.59 57-58.89 113.85c21.43 3.15 36.65-.72 45.14-6.22c12-7.75-3.34-15.72-1.42-24.56c4-18.16 32.55-19 32 5.3c-.36 17.86-25.92 41.81-77.6 35.7c-10.76 59.52-18.35 115-58.2 161.72c-29 34.46-58.4 39.82-71.58 40.26c-24.65.85-41-12.31-41.58-29.84c-.56-17 14.45-26.26 24.31-26.59c21.89-.75 30.12 25.67 14.88 34c-12.09 9.71.11 12.61 2.05 12.55c10.42-.36 17.34-5.51 22.18-9c24-20 33.24-54.86 45.35-118.35c8.19-49.66 17-78 18.23-82c-16.93-12.75-27.08-28.55-49.85-34.72c-15.61-4.23-25.12-.63-31.81 7.83c-7.92 10-5.29 23 2.37 30.7l12.63 14c15.51 17.93 24 31.87 20.8 50.62c-5.06 29.93-40.72 52.9-82.88 39.94c-36-11.11-42.7-36.56-38.38-50.62c7.51-24.15 42.36-11.72 34.62 13.6c-2.79 8.6-4.92 8.68-6.28 13.07c-4.56 14.77 41.85 28.4 51-1.39c4.47-14.52-5.3-21.71-22.25-39.85c-28.47-31.75-16-65.49 2.95-79.67C204.23 140.13 251.94 197 262 205.29c37.17-109 100.53-105.46 102.43-105.53c25.16-.81 44.19 10.59 44.83 28.65c.25 7.69-4.17 22.59-19.52 23.13"></path></svg>
    </a>


                        </div>
                    </p>
                </div>
                <div class="mt-4 pt-3 flex flex-wrap mx-6 border-t justify-center">
                        <div class="text-center mt-1">
        <h2 class="block text-gray-800 text-2xl font-semibold">[Sylius] Restrict Payment Methods depending on customer group</h2>
        <p class="inline-block text-gray-600 text-sm font-base">Published Mar 14, 2021</p>
    </div>
                </div>
            </div>
                    </header>
        <main class="flex-grow">
                <div class="flex flex-col items-center">
        <div class="bg-gray-100 p-6 w-full max-w-4xl">
            <div class="markdown" data-controller="code-highlight">
                                    <div class="bg-orange-100 border-l-4 border-orange-500 text-orange-700 p-4 mb-8" role="alert">
    <p class="font-bold">‚ö†Ô∏è Warning ‚ö†Ô∏è</p>
    <p>This article was written 3 years and 7 months ago. The informations it contains may be outdated or no longer relevant.</p>
</div>

                                <p>It could be common to display some payment methods only to customers that belong to a group.</p>
<p>For example, you can add an offline payment method for you B2B customers, and invoice them at the end of the month, and this offline payment should absolutely not be available for other customer!
Let's see how to integrate this in a Sylius Application.</p>
<h2><a id="content-1-the-quick-and-dirty-way" href="#content-1-the-quick-and-dirty-way" class="heading-permalink" aria-hidden="true" title="Permalink">#</a>1. The Quick and Dirty way</h2>
<p>The form displaying payment methods in Sylius retrieve them from the service <code>sylius.payment_methods_resolver</code>.</p>
<p>Let's decorate it !</p>
<p>First, create a class <code>PaymentMethodsResolverDecorator</code> which extend <code>PaymentMethodsResolverInterface</code>, and that have this same interface as first dependency.</p>
<pre><code class="language-php">// src/Resolver/PaymentMethodsResolverDecorator.php
&lt;?php

declare(strict_types=1);

namespace App\Resolver;

use Sylius\Component\Payment\Model\PaymentInterface;
use Sylius\Component\Payment\Model\PaymentMethodInterface;
use Sylius\Component\Payment\Resolver\PaymentMethodsResolverInterface;

final class PaymentMethodResolverDecorator implements PaymentMethodsResolverInterface
{
    private PaymentMethodsResolverInterface $decorated;

    public function __construct(PaymentMethodsResolverInterface $decorated)
    {
        $this-&gt;decorated = $decorated;
    }

    public function getSupportedMethods(PaymentInterface $subject): array
    {
        return $this-&gt;decorated-&gt;getSupportedMethods($subject);
    }

    public function supports(PaymentInterface $subject): bool
    {
        return $this-&gt;decorated-&gt;supports($subject);
    }
}
</code></pre>
<p>And activate the decoration of service inside your <code>services.yaml</code></p>
<pre><code class="language-yaml">#config/services.yaml
services:
    # ...
    App\Resolver\PaymentMethodResolverDecorator:
        decorates: 'sylius.payment_methods_resolver'
</code></pre>
<p>You are now ready to integrate the  restriction !</p>
<p>The PaymentInterface passed as subject in getSupportedMethods contains the current order,
and the current order contains the customer.</p>
<p>So, if we want exclude the Offline Payment Method named &quot;End of the month&quot;
except for customers that belong to &quot;B2B&quot; group, we could code something like this:</p>
<pre><code class="language-php">//src/Resolver/PaymentMethodsResolverDecorator.php
&lt;?php 
//...
    private const B2B_PAYMENT_METHOD_CODE = 'end_of_month';
    private const B2B_GROUP_CODE = 'b2b';

    public function getSupportedMethods(PaymentInterface $subject): array
    {
        /** @var \App\Entity\Customer\CustomerGroup $customerGroup */
        $customerGroup = $subject-&gt;getOrder()-&gt;getCustomer()-&gt;getGroup();
        $customerGroupCode = null;
        if (null !== $customerGroup) {
            $customerGroupCode = $customerGroup-&gt;getCode();
        }
        
        $supportedMethods = $this-&gt;decorated-&gt;getSupportedMethods($subject);

        foreach ($supportedMethods as $index =&gt; $method) {
            if ($method-&gt;getCode() === self::B2B_PAYMENT_METHOD_CODE &amp;&amp; $customerGroupCode !== self::B2B_GROUP_CODE) {
                // We unset this payment method because customer don't belong to required group
                unset($supportedMethods[$index]);
            }
        }

        return $supportedMethods;
    }
//...
</code></pre>
<p>And that's it ! Navigate on your shop, with a non logged user or an user without group, and you'll never aware about the existence of
&quot;End Of Month&quot; payment method.</p>
<p>Conversely, all customers in the &quot;B2B&quot; group will be able to use it.</p>
<p>This method is great for a quick restriction, but it's not scalable, there is hardcoded code in source...</p>
<p>Let's see how to do it better.</p>
<h2><a id="content-2-the-clean-and-evolving-way" href="#content-2-the-clean-and-evolving-way" class="heading-permalink" aria-hidden="true" title="Permalink">#</a>2. The clean and evolving way</h2>
<p>The best way should be something that is configurable form PaymentMethod Form. We should ideally have a CustomerGroup selector, and if no one is selected, the payment method is accessible for everyone.</p>
<p>So, we should alter the form to get the customer group selector.</p>
<p>The class responsible to render it is <code>Sylius\Bundle\PaymentBundle\Form\Type\PaymentMethodType</code></p>
<p>We could easily extend this form by <a href="https://symfony.com/doc/current/form/create_form_type_extension.html">creating a form type extension</a>, but there is some drawbacks.
First, we should add field on  PaymentMethod Entity, to carry information of customer groups, and alter view of the form to add this new field.
It's definitely not an evolving way, because we could lose template evolution by upgrading Sylius versions.</p>
<p>The Payment Methods offer a Gateway configuration, and everything is stored as a JSON inside the database, and the field already exist.</p>
<p>But, every payment plugin can create their own <a href="https://docs.sylius.com/en/latest/cookbook/payments/custom-payment-gateway.html">Gateway configuration</a>, so we have to do some black magic to add our field on every GatewayConfig.</p>
<p>Let's start by creating a GatewayConfigurationExtension :</p>
<pre><code class="language-php">// src/Form/Extension/GatewayConfigurationExtension.php
&lt;?php
    
declare(strict_types=1);

namespace App\Form\Extension;

use Symfony\Component\Form\AbstractTypeExtension;
use Symfony\Component\Form\FormBuilderInterface;

final class GatewayConfigurationExtension extends AbstractTypeExtension 
{
    public static function getExtendedTypes(): iterable
    {
        // TODO
        return [];
    }
    
    public function buildForm(FormBuilderInterface $builder, array $options): void
    {
        // TODO
    }
}
</code></pre>
<p>Next, we want extend every GatewayConfigurationType provided by plugins.</p>
<p>As we can see, for a Form Extension, we should return the class name of extended types. We cannot provide them here, as we don't want to update this class each time we had a new plugin.</p>
<p>To handle that, we'll use the power of CompilerPass.</p>
<p>Let's modify this class first :</p>
<pre><code class="language-php">// src/Form/Extension/GatewayConfigurationExtension.php
&lt;?php
// ...

    public static array $extendedTypes = [];
    
    public static function getExtendedTypes(): iterable
    {
        return self::$extendedTypes;
    }

    public function setExtendedTypes(array $extendedTypes): void
    {
        self::$extendedTypes = $extendedTypes;
    }
</code></pre>
<p>We add a static property that carry all extendedTypes we want.</p>
<p>Then, the CompilerPass :</p>
<pre><code class="language-php">// src/CompilerPass/GatewayConfigurationExtensionCompilerPass.php
&lt;?php

declare(strict_types=1);

namespace App\CompilerPass;

use App\Form\Extension\GatewayConfigurationExtension;
use Sylius\Bundle\PayumBundle\Form\Type\GatewayConfigType;
use Symfony\Component\DependencyInjection\Compiler\CompilerPassInterface;
use Symfony\Component\DependencyInjection\ContainerBuilder;

final class GatewayConfigurationExtensionCompilerPass implements CompilerPassInterface
{
    public function process(ContainerBuilder $container)
    {
        $gatewayServices = $container-&gt;findTaggedServiceIds('sylius.gateway_configuration_type');
        $gatewayTypes = [GatewayConfigType::class];

        foreach ($gatewayServices as $service =&gt; $definitions) {
            $gatewayTypes[] = $container-&gt;getDefinition($service)-&gt;getClass();
        }
        GatewayConfigurationExtension::$extendedTypes = $gatewayTypes;
        
        $definition = $container-&gt;getDefinition(GatewayConfigurationExtension::class);
        $definition-&gt;addMethodCall('setExtendedTypes', [$gatewaysTypes]);  
    }
}

</code></pre>
<p>Let me explain. We retrieve all services that are tagged as <code>sylius.gateway_configuration_type</code>. This is the tag to apply when plugins want to provide a custom configuration in their PaymentMethod.</p>
<p>We then retrieve the class name for all of these services.
And we set the static property with theses class names.</p>
<p>We also define a <code>methodCall</code> that call our function <code>setExtendedTypes</code>, this is used later when the container is compiled.</p>
<p>The hard coded  <code>GatewayConfigType::class</code> is here to let us handle payment methods without GatewayConfiguration provided. We'll see why in the form extension.</p>
<p>Then, we modify the <code>Kernel</code> class to register this CompilerPass :</p>
<pre><code class="language-php">// src/Kernel.php
&lt;?php
// ...
    protected function build(ContainerBuilder $container): void
    {
        $container-&gt;addCompilerPass(new GatewayConfigurationExtensionCompilerPass());
    }
</code></pre>
<p>At this point, we are still not ready to alter our forms.</p>
<p>In effect, if we try to build the container, an error is raised :</p>
<blockquote>
<p>The getExtendedTypes() method for service &quot;App\Form\Extension\GatewayConfigurationExtension&quot; does not return any extended types.</p>
</blockquote>
<p>It's because the other Compilerpass that register form extensions is processed before our own CompilerPass. To bypass this, we need more black magic !</p>
<p>Let's rework the <code>build</code> method in <code>Kernel</code>.</p>
<pre><code class="language-php">// src/Kernel.php
&lt;?php
// ...
    protected function build(ContainerBuilder $container): void
    {
        $passesBeforeOptimization = $container-&gt;getCompiler()-&gt;getPassConfig()-&gt;getBeforeOptimizationPasses();
        $passTypeToRegisterLater = [FormPass::class];
        $passToRegisterLater = [];

        foreach ($passesBeforeOptimization as $index =&gt; $compilerPass) {
            $compilerClass = \get_class($compilerPass);
            if (\in_array($compilerClass, $passTypeToRegisterLater, true)) {
                unset($passesBeforeOptimization[$index]);
                $passToRegisterLater[] = $compilerPass;
            }
        }
        $container-&gt;getCompiler()-&gt;getPassConfig()-&gt;setBeforeOptimizationPasses($passesBeforeOptimization);

        $container-&gt;addCompilerPass(new GatewayConfigurationExtensionCompilerPass());
        
        foreach ($passToRegisterLater as $compilerPass) {
            $container-&gt;addCompilerPass($compilerPass);
        }
    }
</code></pre>
<p>With this manipulation, we retrieve the CompilerPass responsible to register form extension (<code>FormPass</code>), and we unset it.
We then register our CompilerPass, and after that, we re-register CompilerPass unsetted.</p>
<p>We can now alter our forms. Go back to our Extension :</p>
<pre><code class="language-php">// src/Form/Extension/GatewayConfigurationExtension.php
&lt;?php
// ...
    public function buildForm(FormBuilderInterface $builder, array $options): void
    {
        $customerGroupFormOptions = [
            'entry_type' =&gt; CustomerGroupCodeChoiceType::class,
            'required' =&gt; false,
            'prototype' =&gt; true,
            'allow_add' =&gt; true,
            'allow_delete' =&gt; true,
            'by_reference' =&gt; false,
            'label' =&gt; 'Customer Groups',
        ];

        if ($builder-&gt;getName() === 'config') {
            // This form has a gateway config. Easy, just add field
            $builder-&gt;add('customer_group', CollectionType::class, $customerGroupFormOptions);
            return;
        }
    
        $builder-&gt;addEventListener(FormEvents::PRE_SET_DATA, static function (FormEvent $event) use ($customerGroupFormOptions) {
            /** @var \Symfony\Component\Form\Form $form */
            $form = $event-&gt;getForm();
            if ($form-&gt;has('config')) {
                // already handle (see above)
                return;
            }
            // We are on a PaymentMethod without GatewayConfig (like offline method). 
            // Let's add config key, and customer_group inside.
            $form-&gt;add('config', FormType::class);
            $configForm = $form-&gt;get('config');
            $configForm-&gt;add('customer_group', CollectionType::class, $customerGroupFormOptions);
        });
    }
</code></pre>
<p>And, VOILA ü•≥ We got customer groups selector inside our payment methods form.</p>
<p><img src="https://user-images.githubusercontent.com/3168281/111082452-ab978a80-8508-11eb-844c-b29e52caaaa9.png" alt="image" /></p>
<p>We can finally implement the logic into the Decorator described in part 1.</p>
<pre><code class="language-php">// src/Resolver/PaymentMethodsResolverDecorator.php
&lt;?php
// ...

    public function getSupportedMethods(PaymentInterface $subject): array
    {
        /** @var \App\Entity\Customer\CustomerGroup $customerGroup */
        $customerGroup = $subject-&gt;getOrder()-&gt;getCustomer()-&gt;getGroup();
        $customerGroupCode = null;
        if (null !== $customerGroup) {
            $customerGroupCode = $customerGroup-&gt;getCode();
        }

        $supportedMethods = $this-&gt;decorated-&gt;getSupportedMethods($subject);

        /** @var \App\Entity\Payment\PaymentMethod $method */
        foreach ($supportedMethods as $index =&gt; $method) {
            if (null === $method-&gt;getGatewayConfig()) {
                continue;
            }
            $config = $method-&gt;getGatewayConfig()-&gt;getConfig();
            if (!\array_key_exists('customer_group', $config) || $config['customer_group'] === []) {
                // No customer_groups setted on config
                continue;
            }

            if (!\in_array($customerGroupCode, $config['customer_group'], true)) {
                // CustomerGroup is not in configured groups for this payment method.
                // Unset it
                unset($supportedMethods[$index]);
            }
        }

        return $supportedMethods;
    }
</code></pre>
<h2><a id="content-3-conclusion" href="#content-3-conclusion" class="heading-permalink" aria-hidden="true" title="Permalink">#</a>3. Conclusion</h2>
<p>We saw 2 methods to do the &quot;same thing&quot;.
The first part took me around 20 minutes to code.
The second part took me around 4 hours.</p>
<p>And we get the same result (for the final customer üôÉ)</p>
<p>You may decide to use one or other, or even a third method (share it with me if you have an other üòâ).<br />
Like usual, it depends of your need, and your Customer need.</p>

            </div>
                        <div class="mt-6 mb-0 text-right">
                <a href="#" data-controller="share" class="share hidden mr-2 px-4 py-2 bg-gray-100 text-blue-500 border border-blue-500 hover:bg-blue-500 hover:text-white" data-title="[Sylius] Restrict Payment Methods depending on customer group">
                    <svg width="0.88em" height="1em" viewBox="0 0 448 512" id="8d12b3e2cdc13e1b9d73654849a32ff2" fill="currentColor" class="icon-inline" aria-hidden="true"><path fill="currentColor" d="M352 320c-22.608 0-43.387 7.819-59.79 20.895l-102.486-64.054a96.551 96.551 0 0 0 0-41.683l102.486-64.054C308.613 184.181 329.392 192 352 192c53.019 0 96-42.981 96-96S405.019 0 352 0s-96 42.981-96 96c0 7.158.79 14.13 2.276 20.841L155.79 180.895C139.387 167.819 118.608 160 96 160c-53.019 0-96 42.981-96 96s42.981 96 96 96c22.608 0 43.387-7.819 59.79-20.895l102.486 64.054A96.301 96.301 0 0 0 256 416c0 53.019 42.981 96 96 96s96-42.981 96-96s-42.981-96-96-96"></path></svg>
                    Share
                </a>
                <a href="https://gist.github.com/Jibbarth/53569b2072996fe7d2a36faf2eaa577d"
                   target="_blank" rel="nofollow,noopener"
                   class="px-4 py-2 bg-gray-100 text-blue-500 border border-blue-500 hover:bg-blue-500 hover:text-white">
                    <svg width="1em" height="1em" viewBox="0 0 512 512" id="3104f64de0e0365627cddf65ef9a87e6" fill="currentColor" class="icon-inline" aria-hidden="true"><path fill="currentColor" d="M432 320h-32a16 16 0 0 0-16 16v112H64V128h144a16 16 0 0 0 16-16V80a16 16 0 0 0-16-16H48a48 48 0 0 0-48 48v352a48 48 0 0 0 48 48h352a48 48 0 0 0 48-48V336a16 16 0 0 0-16-16M488 0H360c-21.37 0-32.05 25.91-17 41l35.73 35.73L135 320.37a24 24 0 0 0 0 34L157.67 377a24 24 0 0 0 34 0l243.61-243.68L471 169c15 15 41 4.5 41-17V24a24 24 0 0 0-24-24"></path></svg>
                    React on gist.github.com
                </a>
            </div>
        </div>
        <div class="my-6">
    <a href="/" class="px-4 py-2 bg-gray-100 text-blue-500 border border-blue-500 hover:bg-blue-500 hover:text-white">
        <svg width="1em" height="1em" viewBox="0 0 512 512" id="121491a748087cd553a90652be7cce49" fill="currentColor" class="icon-inline" aria-hidden="true"><path fill="currentColor" d="M256 504C119 504 8 393 8 256S119 8 256 8s248 111 248 248s-111 248-248 248m28.9-143.6L209.4 288H392c13.3 0 24-10.7 24-24v-16c0-13.3-10.7-24-24-24H209.4l75.5-72.4c9.7-9.3 9.9-24.8.4-34.3l-11-10.9c-9.4-9.4-24.6-9.4-33.9 0L107.7 239c-9.4 9.4-9.4 24.6 0 33.9l132.7 132.7c9.4 9.4 24.6 9.4 33.9 0l11-10.9c9.5-9.5 9.3-25-.4-34.3"></path></svg>
        Back to home
    </a>
</div>

    </div>
        </main>
        <footer class="m-auto border-t border-gray-400 py-4 w-full max-w-5xl px-2 md:px-12 md:text-sm text-gray-600">
            <div class="sm:flex justify-between text-center">
                <div class="sm:w-1/2 sm:text-left">
                    ¬© <a href="https://jib√©barth.fr">Jib√© Barth</a>
                </div>
                <div class="w-full sm:text-center">
                    Last generation: Nov 7, 2024, 12:22:26 PM
                </div>
                <div class="sm:w-1/2 sm:text-right">
                        <a
        href="https://github.com/Jibbarth"
        title="Github"
        target="_blank"
        rel="nofollow,noopener"
        class="text-gray-600 hover:text-black"
    >
        <svg 0="0 0 496 512" fill="currentColor" class="icon-inline" aria-hidden="true"><use href="#78b59e68f5bc6b5d0e83965fc61f2065"/></svg>
    </a>
    <a
        href="https://twitter.com/jibbarth"
        title="Twitter"
        target="_blank"
        rel="nofollow,noopener"
        class="text-gray-600 hover:text-black"
    >
        <svg 0="0 0 512 512" fill="currentColor" class="icon-inline" aria-hidden="true"><use href="#8219b698da8a87b88bdb58210f93907f"/></svg>
    </a>
    <a
        href="https://linkedin.com/in/jib√©barth"
        title="Linkedin"
        target="_blank"
        rel="nofollow,noopener"
        class="text-gray-600 hover:text-black"
    >
        <svg 0="0 0 448 512" fill="currentColor" class="icon-inline" aria-hidden="true"><use href="#89398c599d244375d7250c859ddb011f"/></svg>
    </a>
    <a
        href="https://connect.symfony.com/profile/jibbarth"
        title="Symfony"
        target="_blank"
        rel="nofollow,noopener"
        class="text-gray-600 hover:text-black"
    >
        <svg 0="0 0 512 512" fill="currentColor" class="icon-inline" aria-hidden="true"><use href="#e56831514b62735089abaf9ae45ff23c"/></svg>
    </a>


                </div>
            </div>
        </footer>
    </body>
</html>
